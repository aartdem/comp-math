# Отчет по задаче 1

Все измерения проводились на следующем оборудовании:

* Процессор - 11th Gen Intel® Core™ i5-11500 @ 2.70GHz (6 ядер);
* Оперативная память - 16ГБ;
* Операционная система - Ubuntu 22.04.4 LTS;
* Версия gcc - 11.4.0;
* Версия OpenMP - 4.5.

Под временем работы алгоритма понимается время работы метода `calculate_approximation()`, таким образом не учитывается
время, которое тратися на выделение памяти и инициализацию функции начальным приближением. Все измерения проводились с установленным флагом оптимизации -O2.

Для визуализации результатов в виде графиков использовался python версии
3.10.12 и библиотеки, описанные
в [requirements.txt](https://github.com/aartdem/comp-math/blob/main/work1/requirements.txt)

Для оценки полученных значений времени работы использовался доверительный интервал 95%.
## Начальное приближение

Все измерения проводились для $eps=10^{-3}$, с размером блока = 32 и на четрырех потоках.
Основной целью было понять, зависит ли время работы алгоритма от
начального приближения, и если зависит, то как оптимально подобрать начальное приближение для данной функции.
Исследовалось 3 способа инициализации начального приближения для каждой клетки:

* ноль;
* среднее множества $G$;
* случайное значение в диапазоне от $min(G)$ до $max(G)$;

где $G$ - множество значений функции в граничных точках.

Для каждого эксперимента было проведено 20 запусков, были рассмотрены 4 разные функции.
Функции были подобраны так, чтобы у них различались области значений и скорости роста на множестве $[0;1]^2$.
Результаты отражены на таблицах и графиках (точка на графике является средним значением по всем запускам):


<details>
  <summary> $sin(x) + sin(y)$ </summary>
![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/init0.png)

|                    |        50        |        80        |       100        |       200        |       300        |       400        |       500        |       600        |       800        |       1000       |       1500       |       2000       |
|--------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|
|        нули        | $0.004\pm 0.004$ | $0.010\pm 0.010$ | $0.014\pm 0.014$ | $0.044\pm 0.045$ | $0.085\pm 0.086$ | $0.137\pm 0.138$ | $0.205\pm 0.206$ | $0.283\pm 0.285$ | $0.481\pm 0.482$ | $0.767\pm 0.768$ | $1.847\pm 1.869$ | $3.544\pm 3.557$ |
|  среднее значение  | $0.002\pm 0.002$ | $0.004\pm 0.004$ | $0.006\pm 0.006$ | $0.021\pm 0.021$ | $0.040\pm 0.041$ | $0.065\pm 0.065$ | $0.097\pm 0.098$ | $0.135\pm 0.136$ | $0.230\pm 0.240$ | $0.370\pm 0.371$ | $0.896\pm 0.899$ | $1.719\pm 1.723$ |
| случайные значения | $0.002\pm 0.002$ | $0.004\pm 0.005$ | $0.007\pm 0.007$ | $0.022\pm 0.022$ | $0.042\pm 0.043$ | $0.068\pm 0.070$ | $0.102\pm 0.104$ | $0.140\pm 0.143$ | $0.241\pm 0.246$ | $0.383\pm 0.389$ | $0.924\pm 0.944$ | $1.778\pm 1.805$ |

</details>

<details>
  <summary> $x^6+y^6$ </summary>
![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/init1.png)

|                    |        50        |        80        |       100        |       200        |       300        |       400        |       500        |       600        |       800        |       1000       |       1500       |       2000       |
|--------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|
|        нули        | $0.001\pm 0.001$ | $0.004\pm 0.004$ | $0.007\pm 0.007$ | $0.032\pm 0.032$ | $0.071\pm 0.071$ | $0.124\pm 0.124$ | $0.194\pm 0.195$ | $0.279\pm 0.280$ | $0.498\pm 0.499$ | $0.811\pm 0.813$ | $2.028\pm 2.032$ | $3.971\pm 3.982$ |
|  среднее значение  | $0.003\pm 0.003$ | $0.004\pm 0.004$ | $0.006\pm 0.006$ | $0.019\pm 0.019$ | $0.044\pm 0.045$ | $0.079\pm 0.079$ | $0.126\pm 0.126$ | $0.182\pm 0.182$ | $0.327\pm 0.328$ | $0.541\pm 0.542$ | $1.357\pm 1.361$ | $2.665\pm 2.685$ |
| случайные значения | $0.004\pm 0.004$ | $0.007\pm 0.008$ | $0.009\pm 0.009$ | $0.026\pm 0.027$ | $0.050\pm 0.051$ | $0.078\pm 0.080$ | $0.116\pm 0.118$ | $0.160\pm 0.164$ | $0.271\pm 0.276$ | $0.429\pm 0.437$ | $1.042\pm 1.060$ | $1.992\pm 2.022$ |

</details>

<details>
  <summary> $/dfrac 1 {sin(x+y+0.1)}$ </summary>
![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/init2.png)

|                    |        50        |        80        |       100        |       200        |       300        |       400        |       500        |       600        |       800        |       1000       |
|--------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|
|        нули        | $0.005\pm 0.005$ | $0.014\pm 0.014$ | $0.020\pm 0.020$ | $0.079\pm 0.079$ | $0.181\pm 0.181$ | $0.326\pm 0.327$ | $0.534\pm 0.535$ | $0.791\pm 0.792$ | $1.495\pm 1.496$ | $2.563\pm 2.564$ |
|  среднее значение  | $0.003\pm 0.003$ | $0.006\pm 0.006$ | $0.009\pm 0.009$ | $0.046\pm 0.047$ | $0.117\pm 0.117$ | $0.221\pm 0.222$ | $0.375\pm 0.377$ | $0.567\pm 0.568$ | $1.105\pm 1.106$ | $1.929\pm 1.933$ |
| случайные значения | $0.008\pm 0.008$ | $0.027\pm 0.028$ | $0.048\pm 0.049$ | $0.126\pm 0.128$ | $0.234\pm 0.236$ | $0.369\pm 0.372$ | $0.546\pm 0.552$ | $0.751\pm 0.758$ | $1.267\pm 1.276$ | $1.998\pm 2.012$ |

</details>

<details>
  <summary> $e^(2x+2y)$ </summary>
![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/init3.png)

|                    |        50        |        80        |       100        |       200        |       300        |       400        |       500        |       600        |       800        |        1000        |
|--------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|--------------------|
|        нули        | $0.009\pm 0.009$ | $0.036\pm 0.037$ | $0.068\pm 0.068$ | $0.410\pm 0.410$ | $1.016\pm 1.018$ | $1.917\pm 1.928$ | $3.254\pm 3.255$ | $4.918\pm 4.920$ | $9.493\pm 9.545$ | $16.358\pm 16.399$ |
|  среднее значение  | $0.007\pm 0.008$ | $0.028\pm 0.028$ | $0.051\pm 0.051$ | $0.307\pm 0.307$ | $0.655\pm 0.656$ | $1.227\pm 1.228$ | $2.154\pm 2.155$ | $3.322\pm 3.324$ | $6.582\pm 6.600$ | $11.575\pm 11.582$ |
| случайные значения | $0.011\pm 0.011$ | $0.045\pm 0.045$ | $0.087\pm 0.088$ | $0.625\pm 0.628$ | $1.595\pm 1.605$ | $2.379\pm 2.390$ | $3.258\pm 3.274$ | $4.428\pm 4.444$ | $7.460\pm 7.489$ | $11.816\pm 11.857$ |

</details>

Оказалось, что ни для одной из рассмотренных функций неоптимально заполнять первое приближение нулями. При этом для
функций TODO:delete$x^2-y$ и $x^6 - y^6$ оптимальнее оказались случайные значения, а для $f(x,y)=1/sin(x+y+0.1)$ - средние.
Это вызвано тем, что на множестве $[0;1]^2$ функция $f(x,y)$ сильно меняется, например $f(0;0)\approx 10, \ f(0.2;0.2)
\approx 2$ (Эффект будет более заметным, если уменьшить константу 0.1 в знаменателе). При этом значения, близкие к 10,
принимает
относительно небольшое количество точек множества $[0;1]^2$ (так как функция быстро растет у границ). Поэтому при
инициализации случайным числом мы для большей части точек выбираем значения, которые сильнее отличаются от реальных
значений, чем при инициализации средним.

## Анализ времени работы при различном количестве потоков

Возьмем несколько расмотренных ранее функций. Для каждой из них выберем начальное приближение оптимальным способом. Для $sin(x)+sin(y)$ и $x^6+y^6$ значение $eps=10^{-3}$. Для $f(x,y) = 1 / sin(x + y + 0.1)$ значение $eps=10^{-2}$. Размер блока оставляем равным 32. Результаты измерений:

![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/threads0.png)
![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/threads1.png)
![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/threads2.png)

Преимущество параллельного алгоритма заметно на больших значениях N (начиная с 1000) для каждой функции, причем природа функции не влияет на ускорение &mdash; для каждой были получены примерно одинаковые соотношения.

## Анализ времени работы при различном количестве потоков

Зафиксируем $eps=10^{-3}$ и количество потоков = 4. Для функции $\sqrt(x)+2y$ рассмотрим время работы в зависимости от размера блока:

![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/diffsizes.png)

Для данной функции размер блока заметнее влияет на производительность при увеличении N, но эти изменения малы по сравнению с самим временем работы. Даже при $n=1500$ явной зависимости установлено не было, что свидетельствует о том, что различия в значениях были вызваны погрешностью измерений.

## Ошибки аппроксимации

Для вычисления ошибки аппроксимации использовалась формула:
$$e=\dfrac 1 {N^2} \displaystyle\sum_{i = 1}^N\sum_{j = 1}^N \dfrac {\lvert u(i,j)- g(ih, jh)\rvert} {\lvert g(ih,jh)
\rvert}, $$    
где $N$ - количество неграничных узлов в сетке, $h =\frac {1} {N+1}$, $g$ - функция, которую мы приближаем, $u(i,j)$ -
значение получившейся функции в узле $(i,j)$.

При измерениях было установлено, что при уменьшении $eps$ достигалась лучшая точность. Это логично, так как алгоритм итерационный и при меньшем значении $eps$ он сделает больше итераций приближения функции:

![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/error.png)
