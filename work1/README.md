# Отчет по задаче 1

Все измерения проводились на следующем оборудовании:

* Процессор - 11th Gen Intel® Core™ i5-11500 @ 2.70GHz (6 ядер);
* Оперативная память - 16ГБ;
* Операционная система - Ubuntu 22.04.4 LTS;
* Версия gcc - 11.4.0;
* Версия OpenMP - 4.5.

Под временем работы алгоритма понимается время работы метода `calculate_approximation()`, таким образом не учитывается
время, которое тратися на выделение памяти и инициализацию функции начальным приближением. Все измерения проводились с
установленным флагом оптимизации -O2.
Во всех экспериментах рассматривались только непрерывные на [0;1]^2 функции.

Для визуализации результатов в виде графиков использовался python версии
3.10.12 и библиотеки, описанные
в [requirements.txt](https://github.com/aartdem/comp-math/blob/main/work1/requirements.txt)

Для оценки полученных значений времени работы использовался доверительный интервал 95%.

## Начальное приближение

Все измерения проводились для $eps=10^{-3}$, с размером блока = 32 и на четрырех потоках.
Основной целью было понять, зависит ли время работы алгоритма от
начального приближения, и если зависит, то как оптимально подобрать начальное приближение для данной функции.
Исследовалось 3 способа инициализации начального приближения для каждой клетки:

* ноль;
* среднее множества $G$;
* случайное значение в диапазоне от $min(G)$ до $max(G)$;

где $G$ - множество значений функции в граничных точках.

Были рассмотрены 4 разные функции, для каждого эксперимента было проведено 20 запусков.
Эксперимент - для конкретной функции выбираем количество узлов N и стратегию для выбора начального приближения.
Функции были подобраны так, чтобы у них различались области значений и скорости роста на множестве $[0;1]^2$.
Результаты отражены в таблицах и графиках (точка на графике является средним значением по всем запускам),
в таблицах можно увидеть посчитанные доверительные интервалы:


<details>
  <summary> $sin(x) + sin(y)$ </summary>

![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/init0.png)

|                    |    50   |    80   |   100   |   200   |   300   |   400   |       500        |       600        |       800        |       1000       |       1500       |       2000       |
|--------------------|---------|---------|---------|---------|---------|---------|------------------|------------------|------------------|------------------|------------------|------------------|
|        нули        | $0.004$ | $0.010$ | $0.014$ | $0.045$ | $0.085$ | $0.138$ |     $0.205$      |     $0.284$      |     $0.481$      |     $0.767$      | $1.858\pm 0.011$ | $3.551\pm 0.006$ |
|  среднее значение  | $0.002$ | $0.004$ | $0.006$ | $0.021$ | $0.040$ | $0.065$ |     $0.098$      |     $0.135$      | $0.235\pm 0.005$ |     $0.370$      | $0.898\pm 0.002$ | $1.721\pm 0.002$ |
| случайные значения | $0.002$ | $0.004$ | $0.007$ | $0.022$ | $0.043$ | $0.069$ | $0.103\pm 0.001$ | $0.142\pm 0.002$ | $0.244\pm 0.002$ | $0.386\pm 0.003$ | $0.934\pm 0.010$ | $1.791\pm 0.013$ |

</details>

<details>
  <summary> $x^6+y^6$ </summary>

![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/init1.png)

|                    |    50   |    80   |   100   |   200   |   300   |   400   |   500   |       600        |       800        |       1000       |       1500       |       2000       |
|--------------------|---------|---------|---------|---------|---------|---------|---------|------------------|------------------|------------------|------------------|------------------|
|        нули        | $0.001$ | $0.004$ | $0.007$ | $0.032$ | $0.071$ | $0.124$ | $0.194$ |     $0.280$      |     $0.499$      |     $0.812$      | $2.030\pm 0.002$ | $3.977\pm 0.006$ |
|  среднее значение  | $0.003$ | $0.004$ | $0.006$ | $0.019$ | $0.044$ | $0.079$ | $0.126$ |     $0.182$      |     $0.328$      |     $0.542$      | $1.359\pm 0.002$ | $2.675\pm 0.010$ |
| случайные значения | $0.004$ | $0.008$ | $0.009$ | $0.027$ | $0.050$ | $0.079$ | $0.117$ | $0.162\pm 0.002$ | $0.274\pm 0.003$ | $0.433\pm 0.004$ | $1.051\pm 0.009$ | $2.007\pm 0.015$ |

</details>

<details>
  <summary> $\dfrac 1 {sin(x+y+0.1)}$ </summary>

![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/init2.png)

|                    |    50   |    80   |   100   |   200   |       300        |       400        |       500        |       600        |       800        |       1000       |
|--------------------|---------|---------|---------|---------|------------------|------------------|------------------|------------------|------------------|------------------|
|        нули        | $0.005$ | $0.014$ | $0.020$ | $0.079$ |     $0.181$      |     $0.326$      |     $0.534$      |     $0.792$      |     $1.496$      |     $2.564$      |
|  среднее значение  | $0.003$ | $0.006$ | $0.009$ | $0.047$ |     $0.117$      |     $0.222$      |     $0.376$      |     $0.567$      |     $1.105$      | $1.931\pm 0.002$ |
| случайные значения | $0.008$ | $0.027$ | $0.049$ | $0.127$ | $0.235\pm 0.001$ | $0.371\pm 0.002$ | $0.549\pm 0.003$ | $0.755\pm 0.003$ | $1.272\pm 0.005$ | $2.005\pm 0.007$ |

</details>

<details>
  <summary> $e^{2x+2y}$ </summary>

![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/init3.png)

|                    |    50   |    80   |   100   |       200        |       300        |       400        |       500        |       600        |       800        |        1000       |
|--------------------|---------|---------|---------|------------------|------------------|------------------|------------------|------------------|------------------|-------------------|
|        нули        | $0.009$ | $0.036$ | $0.068$ |     $0.410$      |     $1.017$      | $1.923\pm 0.006$ |     $3.255$      | $4.919\pm 0.001$ | $9.519\pm 0.026$ | $16.379\pm 0.020$ |
|  среднее значение  | $0.008$ | $0.028$ | $0.051$ |     $0.307$      |     $0.655$      |     $1.227$      |     $2.154$      |     $3.323$      | $6.591\pm 0.009$ | $11.579\pm 0.003$ |
| случайные значения | $0.011$ | $0.045$ | $0.088$ | $0.627\pm 0.001$ | $1.600\pm 0.005$ | $2.384\pm 0.005$ | $3.266\pm 0.008$ | $4.436\pm 0.008$ | $7.474\pm 0.014$ | $11.836\pm 0.021$ |

</details>

Отношение стандартного отклонения к среднему для всех проведенных экспериментов не превышает 5%, то есть можно
анализировать полученные данные.
Оказалось, что ни для одной из рассмотренных функций неоптимально заполнять первое приближение нулями. При этом для
функции $x^6 - y^6$ оптимальнее оказались случайные значения, а для $f(x,y)=1/sin(x+y+0.1) и g(x,y)=e^{2x+2y}$ -
средние.
Особенно это заментно при N < 1000.
Это вызвано тем, что на множестве $[0;1]^2$ эти функции сильно меняются, например, $f(0;0)\approx 10, \ f(0.2;0.2)
\approx 2$ (Эффект будет более заметным, если уменьшить константу 0.1 в знаменателе). При этом значения, близкие к 10,
принимает относительно небольшое количество точек множества $[0;1]^2$ (так как функция быстро растет у границ). Поэтому
при
инициализации случайным числом мы для большей части точек выбираем значения, которые сильнее отличаются от реальных
значений функции, чем при инициализации средним.

## Анализ времени работы при различном количестве потоков

Возьмем расмотренные ранее функции. Как и в прошлых экспериментах, они отличаются областью значений и скоростью
изменения.
Для каждой из них выберем начальное приближение оптимальным способом, полученным ранее. Размер блока оставим равным 32.
Для каждого эксперимента было проведено 10 запусков. Результаты измерений:

<details>
  <summary> $sin(x) + sin(y)$ </summary>

![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/threads0.png)

|   |    50   |    80   |   100   |   200   |       300        |       400        |       500        |       600        |       800        |       1000       |       1500       |       2000       |
|---|---------|---------|---------|---------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|
| 1 | $0.002$ | $0.006$ | $0.010$ | $0.045$ | $0.105\pm 0.002$ | $0.189\pm 0.003$ | $0.304\pm 0.006$ | $0.444\pm 0.005$ | $0.818\pm 0.015$ | $1.378\pm 0.020$ | $3.581\pm 0.037$ | $6.667\pm 0.086$ |
| 2 | $0.002$ | $0.005$ | $0.008$ | $0.029$ |     $0.062$      | $0.107\pm 0.002$ | $0.167\pm 0.003$ | $0.234\pm 0.003$ | $0.431\pm 0.006$ | $0.696\pm 0.009$ | $1.780\pm 0.025$ | $3.359\pm 0.037$ |
| 4 | $0.002$ | $0.004$ | $0.007$ | $0.022$ |     $0.043$      | $0.068\pm 0.001$ | $0.104\pm 0.002$ | $0.142\pm 0.002$ | $0.241\pm 0.003$ | $0.389\pm 0.007$ | $0.907\pm 0.015$ | $1.757\pm 0.032$ |
| 6 | $0.002$ | $0.005$ | $0.008$ | $0.020$ | $0.039\pm 0.002$ |     $0.059$      | $0.088\pm 0.001$ | $0.115\pm 0.002$ | $0.194\pm 0.003$ | $0.302\pm 0.005$ | $0.735\pm 0.009$ | $1.332\pm 0.021$ |

</details>

<details>
  <summary> $x^6+y^6$ </summary>

![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/threads1.png)

|   |    50   |    80   |   100   |       200        |       300        |       400        |       500        |       600        |       800        |       1000       |       1500       |       2000       |
|---|---------|---------|---------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|------------------|
| 1 | $0.002$ | $0.006$ | $0.010$ | $0.044\pm 0.001$ | $0.104\pm 0.001$ | $0.191\pm 0.003$ | $0.305\pm 0.007$ | $0.444\pm 0.008$ | $0.826\pm 0.009$ | $1.374\pm 0.016$ | $3.602\pm 0.059$ | $6.730\pm 0.089$ |
| 2 | $0.002$ | $0.005$ | $0.008$ |     $0.029$      | $0.062\pm 0.001$ | $0.108\pm 0.002$ | $0.165\pm 0.002$ | $0.237\pm 0.004$ | $0.426\pm 0.008$ | $0.693\pm 0.011$ | $1.776\pm 0.022$ | $3.366\pm 0.059$ |
| 4 | $0.002$ | $0.005$ | $0.007$ |     $0.022$      |     $0.043$      |     $0.069$      | $0.104\pm 0.002$ | $0.142\pm 0.002$ | $0.243\pm 0.003$ | $0.390\pm 0.008$ | $0.926\pm 0.012$ | $1.754\pm 0.026$ |
| 6 | $0.002$ | $0.005$ | $0.007$ |     $0.019$      |     $0.039$      |     $0.058$      | $0.088\pm 0.002$ | $0.117\pm 0.002$ | $0.192\pm 0.003$ | $0.302\pm 0.003$ | $0.726\pm 0.012$ | $1.340\pm 0.019$ |

</details>

<details>
  <summary> $\dfrac 1 {sin(x+y+0.1)}$ </summary>

![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/threads2.png)

|   |    50   |    80   |   100   |   200   |   300   |   400   |       500        |   600   |       800        |       1000       |        1500       |        2000       |
|---|---------|---------|---------|---------|---------|---------|------------------|---------|------------------|------------------|-------------------|-------------------|
| 1 | $0.003$ | $0.007$ | $0.013$ | $0.095$ | $0.285$ | $0.612$ | $1.107\pm 0.002$ | $1.774$ | $3.755\pm 0.003$ | $6.948\pm 0.012$ | $20.684\pm 0.094$ | $42.093\pm 0.061$ |
| 2 | $0.002$ | $0.006$ | $0.010$ | $0.060$ | $0.167$ | $0.343$ |     $0.597$      | $0.936$ | $1.922\pm 0.003$ | $3.414\pm 0.002$ | $10.268\pm 0.025$ | $20.998\pm 0.030$ |
| 4 | $0.003$ | $0.005$ | $0.009$ | $0.046$ | $0.116$ | $0.221$ |     $0.373$      | $0.567$ | $1.102\pm 0.003$ | $1.923\pm 0.001$ |  $5.341\pm 0.018$ | $11.214\pm 0.014$ |
| 6 | $0.003$ | $0.006$ | $0.009$ | $0.040$ | $0.104$ | $0.187$ |     $0.316$      | $0.460$ |     $0.877$      |     $1.503$      |  $4.195\pm 0.008$ |  $8.454\pm 0.040$ |

</details>

Отношение стандартного отклонения к среднему для всех проведенных экспериментов не превышает 6%.
Преимущество параллельного алгоритма заметно на больших значениях N (начиная с 1000) для каждой функции, причем скорость роста функции не влияет на ускорение &mdash; для каждой были получены примерно одинаковые соотношения.

## Анализ времени работы при различных размерах блоков

Зафиксируем $eps=10^{-3}$ и количество потоков = 4. Для функции $\sqrt x +2y$ рассмотрим время работы в зависимости от
размера блока. Каждый эксперимент за пустим 10 раз:

<details>
  <summary> График </summary>

![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/diffsizes.png)

</details>

Как видно из графика, для всех N самым оптимальным оказался размер блока в передалах [8;16].
Также все три графика имеют локальный минимум, наиболее выраженный при N = 1500. Это можно объяснить тем, что чем больше размер блока, 
тем параллелизм приносит меньшее ускорение. При этом чем меньше размер блока, тем чаще приходится переключаться между блоками, а учитывая, что 
у наш алгоритм идет по блокам "волной", то чем чаще будет происходить такое переключение, тем чаще должна происходить перезапись кэша.
Соответственно, точка локального минимума - та точка, где достигается "компромисс". 

## Ошибки аппроксимации

Для вычисления ошибки аппроксимации использовалась формула:
$$e=\dfrac 1 {N^2} \displaystyle\sum_{i = 1}^N\sum_{j = 1}^N \dfrac {\lvert u(i,j)- g(ih, jh)\rvert} {\lvert g(ih,jh)
\rvert}, $$    
где $N$ - количество неграничных узлов в сетке, $h =\frac {1} {N+1}$, $g$ - функция, которую мы приближаем, $u(i,j)$ -
значение получившейся функции в узле $(i,j)$.
Природа функции не была главным фактором в этом эксперименте, основной целью было найти зависимость 
ошибки от выбранного $eps$ для конкретной функции. Поэтому для простоты она была выбрана так ($\sqrt x + 2y$), чтобы скорость изменения была меньше по сравнению
с ранее рассматриваемыми функциями. При это эксперимент запускался один раз, так как рассматриваемый алгоритм детерминированный 
и для подсчета ошибки нет смысла запускать его более одного раза.

Итак, было установлено, что при уменьшении $eps$ достигалась лучшая точность. Это логично, так как алгоритм
итерационный и при меньшем значении $eps$ он сделает больше итераций приближения функции:

![](https://github.com/aartdem/comp-math/blob/main/work1/imgs/error.png)
